---
aliases: 
tags:
  - maturity/üå±
date: 2024-09-08
zero-link:
  - "[[../../meta/zero/00 –°–µ—Ç–∏|00 –°–µ—Ç–∏]]"
parents: 
linked:
---
–í –¥–∞–Ω–Ω–æ–π –∑–∞–º–µ—Ç–∫–µ —è —Ä–∞—Å—Å–∫–∞–∂—É, –∫–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç—å—é –∑–∞ —Ä–æ—É—Ç–µ—Ä–æ–º Keenetic, –µ—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤—ã—Ö–æ–¥ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —á–µ—Ä–µ–∑ WG —Å–µ—Ä–≤–µ—Ä —Å —Ä–æ—É—Ç–µ—Ä–∞ –∏ —Ç–µ–ª–µ—Ñ–æ–Ω–∞.

–ë–ª–∞–≥–æ–¥–∞—Ä—è VPN —Ñ–∞–π–ª—ã –∏–∑ –º–æ–µ–π –¥–æ–º–∞—à–Ω–µ–π —Å–µ—Ç–∏ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω—ã, –≥–¥–µ –±—ã —è –Ω–µ –±—ã–ª.

–ö–∞–∫ —è —É–∂–µ –≥–æ–≤–æ—Ä–∏–ª —É –≤–∞—Å —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω Wireguard —Å–µ—Ä–≤–µ—Ä, —Ä–æ—É—Ç–µ—Ä –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–æ–ª–∂–Ω—ã –≤—ã—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç —Å–µ—Ä–≤–µ—Ä –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. –Ø –∂–µ —Ä–∞—Å—Å–∫–∞–∂—É, –∫–∞–∫ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ø–∞—Å—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å –∑–∞ —Ä–æ—É—Ç–µ—Ä–æ–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Wireguard, –∏ –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å VPN –≤—ã—Ö–æ–¥ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–Ω—Å–æ–ª—å —Ä–æ—É—Ç–µ—Ä–∞ Keenetic.
## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Keenetic
–ï—Å–ª–∏ –¥–æ—Å—Ç—É–ø–∞ –≤ –∫–æ–Ω—Å–æ–ª—å –Ω–µ—Ç, —Ç–æ –µ–≥–æ –Ω–∞–¥–æ –≤–∫–ª—é—á–∏—Ç—å. –î–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª ‚Äú–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ‚Äù -> ‚Äú–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø‚Äù. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ—Ä—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ SSH –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø—É–Ω–∫—Ç ‚Äú–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ –ø–æ SSH‚Äù.

![](../../meta/files/images/Pasted%20image%2020240908111536.png)

–¢–∞–∫–∂–µ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ SSH. –ù–∞ —Ç–æ–π –∂–µ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —É –≤–∞—Å –µ—Å—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –ó–∞–π–¥–∏—Ç–µ –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏ —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –Ω–µ–≥–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø—É–Ω–∫—Ç ‚Äú–î–æ—Å—Ç—É–ø –∫ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ (TELNET –∏ SSH)‚Äù.

![](../../meta/files/images/Pasted%20image%2020240908111551.png)

–¢–µ–ø–µ—Ä—å –∑–∞—Ö–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–æ–º.

```shell
ssh username@192.168.0.1
(config)>
```

–ü–µ—Ä–≤—ã–º –¥–µ–ª–æ–º –Ω–∞–º –Ω–∞–¥–æ —É–∑–Ω–∞—Ç—å, –∫–∞–∫–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—ã–ª –ø—Ä–∏—Å–≤–æ–µ–Ω –Ω–∞—à–µ–º—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ. –ï—Å–ª–∏ —ç—Ç–æ –≤–∞—à–µ –ø–µ—Ä–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å Wireguard, —Ç–æ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ —ç—Ç–æ Wireguard0. –ù–æ –¥–∞–≤–∞–π—Ç–µ —É–±–µ–¥–∏–º—Å—è –≤ —ç—Ç–æ–º.

–î–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–≤–µ—Å—Ç–∏ `interface Wire` –∏ –Ω–∞–∂–∞—Ç—å `Tab`:

```shell
(config)> interface Wire

    Usage template:
        interface {name}

    Choose:
        Wireguard
        Wireguard0
```

–ß—Ç–æ–±—ã —Ç–æ—á–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è –≤—ã–≤–µ–¥–∏—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞.

```shell {6,13}
(config)> show interface Wireguard0

    id: Wireguard0
    index: 1
    type: Wireguard
    description: vpn-example
    interface-name: Wireguard0
    link: up
    connected: yes
    state: up
    mtu: 1324
    tx-queue-length: 50
    address: 10.66.67.2
    mask: 255.255.255.255
    uptime: 5
    global: no
    security-level: public

        wireguard:
           public-key: PUBLIC_KEY
          listen-port: 48951
               status: up

                 peer:
               public-key: PUBLIC_KEY
                    local: 37.112.97.194
               local-port: 48951
                      via: PPPoE0
                   remote: 3.64.232.61
              remote-port: 54161
                  rxbytes: 92
                  txbytes: 180
           last-handshake: 5
                   online: yes
```

–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏ –∞–¥—Ä–µ—Å—É –ø–æ–Ω–∏–º–∞–µ–º, —á—Ç–æ —ç—Ç–æ –Ω—É–∂–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

![](../../meta/files/images/Pasted%20image%2020240908112035.png)

–ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–æ –Ω–∞ IN, –∏–Ω–∞—á–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å –±—É–¥—É—Ç –¥—Ä–æ–ø–∞—Ç—å—Å—è. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å `Wireguard0` –Ω–∞ –¥—Ä—É–≥–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, –µ—Å–ª–∏ —É –≤–∞—Å –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω –¥—Ä—É–≥–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.

```shell
(config)> interface Wireguard0
Core::Configurator: Done.
(config-if)> ip access-group _WEBADMIN_Wireguard0 in
Network::Acl: Input "_WEBADMIN_Wireguard0" access list added to "Wireguard0".
(config-if)> system configuration save
Core::ConfigurationSaver: Saving configuration...
```

–¢–µ–ø–µ—Ä—å –Ω–∞–¥–æ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –º–∞—Ä—à—Ä—É—Ç –¥–æ —Å–µ—Ç–∏ Wireguard.

```shell
(config)> ip route 10.66.67.0 255.255.255.0 Wireguard0 auto
Network::RoutingTable: Added static route: 10.66.67.0/24 via Wireguard0.
```

> [!DANGER]
> –ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ —Å–≤–æ–∏. `10.66.67.0` –Ω–∞ —Å–≤–æ—é –ø–æ–¥—Å–µ—Ç—å Wireguard, –∞ `Wireguard0` –Ω–∞ —Å–≤–æ–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å.
## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ WG
–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ—Ä–≤–µ—Ä Wireguard. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –æ–±—ã—á–Ω–æ –æ–Ω –ª–µ–∂–∏—Ç –≤ –ø–∞–ø–∫–µ `/etc/wireguard/wg0.conf`. –ó–∞–π–¥–∏—Ç–µ –ø–æ–¥ root.

```shell
su
nano /etc/wireguard/wg0.conf
```

```toml
[Interface]
Address = 10.66.67.1/24,fd42:42:43::1/64
ListenPort = 54161
PrivateKey = PRIVATE_KEY
PostUp = iptables -A FORWARD -i eth0 -o wg0 -j ACCEPT; iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables $
PostDown = iptables -D FORWARD -i eth0 -o wg0 -j ACCEPT; iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6table$

### Client router
[Peer]
PublicKey = PUBLIC_KEY
PresharedKey = PRESHARED_KEY
AllowedIPs = 10.66.67.2/32,fd42:42:43::2/128,192.168.1.0/24

### Client phone
[Peer]
PublicKey = PUBLIC_KEY
PresharedKey = PRESHARED_KEY
AllowedIPs = 10.66.67.3/32,fd42:42:43::3/128
```

–£ –Ω–∞—Å —Ç—É—Ç –≤—Å–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ. –î–≤–∞ –ø–∏—Ä–∞, –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö —Ä–æ—É—Ç–µ—Ä, –≤—Ç–æ—Ä–æ–π —Ç–µ–ª–µ—Ñ–æ–Ω. –î–ª—è —Ä–æ—É—Ç–µ—Ä–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –≤ `AllowedIPs` –≤–∞—à—É –ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å, –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ `192.168.1.0/24`.

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –æ—Ç–∫–ª—é—á–∏–º –∏ –≤–∫–ª—é—á–∏–º WG —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

```shell
wg-quick down wg0
[#] ip link delete dev wg0
[#] iptables -D FORWARD -i eth0 -o wg0 -j ACCEPT; iptables -D FORWARD -i wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o eth0 -j MASQUERADE; ip6tables -D FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -D POSTROUTING -o eth0 -j MASQUERADE
wg-quick up wg0
[#] ip link add wg0 type wireguard
[#] wg setconf wg0 /dev/fd/63
[#] ip -4 address add 10.66.67.1/24 dev wg0
[#] ip -6 address add fd42:42:43::1/64 dev wg0
[#] ip link set mtu 8921 up dev wg0
[#] ip -4 route add 192.168.0.0/24 dev wg0
[#] iptables -A FORWARD -i eth0 -o wg0 -j ACCEPT; iptables -A FORWARD -i wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE; ip6tables -A FORWARD -i wg0 -j ACCEPT; ip6tables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —É –≤–∞—Å –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ —Ä–æ—É—Ç–µ—Ä–∞ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–∞ —á–µ—Ä–µ–∑ Wireguard VPN. –ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤.
***
## –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
**–û–±–ª–∞—Å—Ç—å**:: [[../../meta/zero/00 –°–µ—Ç–∏|00 –°–µ—Ç–∏]]
**–†–æ–¥–∏—Ç–µ–ª—å**:: 
**–ò—Å—Ç–æ—á–Ω–∏–∫**:: 
**–ê–≤—Ç–æ—Ä**:: 
**–°–æ–∑–¥–∞–Ω–∞**:: [[2024-09-08]]
### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ VPN —Å AmneziaWG –Ω–∞ —Ä–æ—É—Ç–µ—Ä—ã Keenetic | Amnezia Docs](https://docs.amnezia.org/ru/documentation/instructions/keenetic-os-awg/)
### –î–æ—á–µ—Ä–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
<!-- QueryToSerialize: LIST FROM [[]] WHERE contains(–†–æ–¥–∏—Ç–µ–ª—å, this.file.link) or contains(parents, this.file.link) -->
