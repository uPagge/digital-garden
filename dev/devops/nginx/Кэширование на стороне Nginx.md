---
aliases: 
tags:
  - maturity/üå±
date: 2024-04-07
---
–î–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–æ–∂–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ Nginx, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–¥–∫–æ –∏–∑–º–µ–Ω—è—é—Ç—Å—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä—É –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –µ–≥–æ –¥—Ä—É–≥–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º, —Å–Ω–∏–∂–∞—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –≤ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∞:

```shell
sudo mkdir -p /var/nginx/cache
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ, –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª `nginx.conf` –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–∏–≤:

```nginx
http {
    proxy_cache_path /var/nginx/cache levels=1:2 keys_zone=nginxcash:60m max_size=256m inactive=24h;
    proxy_cache_key "$scheme$request_method$host$request_uri";
    proxy_cache_methods GET HEAD;
    proxy_cache_min_uses 2;
}
```

`proxy_cache_path` ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –≥–¥–µ –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

- –ü–∞—Ä–∞–º–µ—Ç—Ä `levels` –∑–∞–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–∞–ø–æ–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫—ç—à–∞, keys_zone –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–∞–∑–º–µ—Ä –∑–æ–Ω—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ 60 –º–µ–≥–∞–±–∞–π—Ç).
- `max_size=256m` –∑–∞–¥–∞–µ—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞.
- `inactive=24h` —É–∫–∞–∑—ã–≤–∞–µ—Ç, —á—Ç–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫ –∫–æ—Ç–æ—Ä—ã–º –Ω–µ –±—ã–ª–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤, –±—É–¥—É—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª–µ–Ω—ã.

`proxy_cache_key` ‚Äî –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–ª—é—á –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Å—Ö–µ–º—ã –∑–∞–ø—Ä–æ—Å–∞, –º–µ—Ç–æ–¥–∞, —Ö–æ—Å—Ç–∞ –∏ URI. –≠—Ç–æ—Ç –∫–ª—é—á –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∫—ç—à –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥–¥–æ–º–µ–Ω–æ–≤ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

`proxy_cache_methods` ‚Äî —É–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–∏–µ HTTP-–º–µ—Ç–æ–¥—ã –±—É–¥—É—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å—Å—è (–≤ –¥–∞–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ ‚Äî —Ç–æ–ª—å–∫–æ –º–µ—Ç–æ–¥—ã GET –∏ HEAD).

`proxy_cache_min_uses` ‚Äî –∑–∞–¥–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫ —Ä–µ—Å—É—Ä—Å—É –ø–µ—Ä–µ–¥ –µ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–Ω–∞—á–µ–Ω–∏—è 2 –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—á–Ω–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—Ç–æ—Ä–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è, —á—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –∑–∞–ø–∏—Å—å.
## –ü–µ—Ä–µ–Ω–æ—Å–∏–º –∫—ç—à Nginx –≤ RAM
–ß—Ç–æ–±—ã –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –∫—ç—à, –º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ (RAM) –≤–º–µ—Å—Ç–æ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –¥–∞–Ω–Ω—ã–º.

–î–ª—è —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –∫—ç—à–∞ (–µ—Å–ª–∏ –æ–Ω–∞ —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞, –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –µ—ë –æ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ) –∏ –º–æ–Ω—Ç–∏—Ä—É–µ–º –µ—ë –≤ RAM —Å –ø–æ–º–æ—â—å—é [tmpfs](https://wiki.archlinux.org/index.php/Tmpfs). –í—ã–¥–µ–ª–∏–º 256 –º–µ–≥–∞–±–∞–π—Ç –ø–æ–¥ –∫—ç—à:

```shell
sudo mount -t tmpfs -o size=256M tmpfs /var/nginx/cache
```

–ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Ç–∫–ª—é—á–∏—Ç—å RAM-–∫—ç—à, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```shell
sudo umount /var/nginx/cache
```

–ß—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞—Ç—å –∫—ç—à –≤ RAM –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª `/etc/fstab`. –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É:

```txt
tmpfs /var/nginx/cache tmpfs defaults,size=256M 0 0
```
***
## –ú–µ—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
**–û–±–ª–∞—Å—Ç—å**:: [[../../../meta/zero/00 Nginx|00 Nginx]]
**–†–æ–¥–∏—Ç–µ–ª—å**:: [[../../architecture/–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ|–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ]]
**–ò—Å—Ç–æ—á–Ω–∏–∫**:: 
**–ê–≤—Ç–æ—Ä**:: 
**–°–æ–∑–¥–∞–Ω–∞**:: [[2024-04-07]]
### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- [–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è NGINX](https://struchkov.dev/blog/ru/nginx-optimization/)
- [Nginx cache: –≤—Å—ë –Ω–æ–≤–æ–µ ‚Äî —Ö–æ—Ä–æ—à–æ –∑–∞–±—ã—Ç–æ–µ —Å—Ç–∞—Ä–æ–µ / –•–∞–±—Ä](https://habr.com/ru/post/428127/)
- [[../../devops/nginx/–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏ –≤ Nginx|–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏ –≤ Nginx]]
### –î–æ—á–µ—Ä–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏
<!-- QueryToSerialize: LIST FROM [[]] WHERE contains(–†–æ–¥–∏—Ç–µ–ª—å, this.file.link) or contains(parents, this.file.link) -->
