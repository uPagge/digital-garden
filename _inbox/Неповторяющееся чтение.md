---
aliases:
  - non-repeatable reads
tags:
  - –∑—Ä–µ–ª–æ—Å—Ç—å/üå±
date:
  - - 2024-06-19
zero-link:
  - "[[00 –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö]]"
parents:
  - "[[–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π]]"
linked: 
link: https://struchkov.dev/blog/ru/transactional-isolation-levels/#%D0%BD%D0%B5%D0%BF%D0%BE%D0%B2%D1%82%D0%BE%D1%80%D1%8F%D1%8E%D1%89%D0%B5%D0%B5%D1%81%D1%8F-%D1%87%D1%82%D0%B5%D0%BD%D0%B8%D0%B5
---
**–ù–µ–ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —á—Ç–µ–Ω–∏–µ (non-repeatable reads).** –ó–∞–ø—Ä–æ—Å —Å –æ–¥–Ω–∏–º–∏ –∏ —Ç–µ–º–∏ –∂–µ —É—Å–ª–æ–≤–∏—è–º–∏ –¥–∞—ë—Ç –Ω–µ–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ä–∞–º–∫–∞—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏. ^3e8781

–≠—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–∑–æ–ª—è—Ü–∏–∏¬†[Read committed](Read%20committed.md)¬†–∏ [Read uncommitted](Read%20uncommitted.md).

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä. –ù–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. –°—á–∏—Ç—ã–≤–∞–µ–º –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ 1000. –î–∞–ª–µ–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –≤—Ç–æ—Ä–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ, –∞ —Ç–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –∑–∞—Å—ã–ø–∞–µ—Ç.

–í–æ –≤—Ç–æ—Ä–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –±–∞–ª–∞–Ω—Å —Ä–∞–≤–Ω—ã–π 100_000. –ü–æ—Å–ª–µ —á–µ–≥–æ –∑–∞–∫—Ä—ã–≤–∞–µ–º –≤—Ç–æ—Ä—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. –ë–∞–ª–∞–Ω—Å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–∏–ª—Å—è –≤ –ë–î.

–ü–µ—Ä–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ. –°–Ω–æ–≤–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –ë–î, –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ 100_000. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—Ç–æ—Ä–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø–æ–≤–ª–∏—è–ª–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–π.

```java
public class NonRepeatableRead {

    private static final int ISOLATION_LEVEL = Connection.TRANSACTION_READ_COMMITTED;

    public static void main(String[] args) {
        try (
                final Connection connection = Repository.getConnection();
                final Statement statement = connection.createStatement()
        ) {
            connection.setAutoCommit(false);
            connection.setTransactionIsolation(ISOLATION_LEVEL);

            final ResultSet resultSetOne = statement.executeQuery("SELECT * FROM person WHERE id = 1");
            while (resultSetOne.next()) {
                final String balance = resultSetOne.getString("balance");
                System.out.println("[one] Balance: " + balance);
            }

            new OtherTransaction().start();
            Thread.sleep(2000);

            final ResultSet resultSetTwo = statement.executeQuery("SELECT * FROM person WHERE id = 1");
            while (resultSetTwo.next()) {
                final String balance = resultSetTwo.getString("balance");
                System.out.println("[one] Balance: " + balance);
            }

        } catch (SQLException | InterruptedException e) {
            throw new RuntimeException(e);
        }
    }

    static class OtherTransaction extends Thread {
        @Override
        public void run() {
            try (
                    final Connection connection = Repository.getConnection();
                    final Statement statement = connection.createStatement()
            ) {
                connection.setAutoCommit(false);
                connection.setTransactionIsolation(ISOLATION_LEVEL);

                statement.executeUpdate("UPDATE person SET balance = 100000 WHERE id = 1");
                connection.commit();

                final ResultSet resultSetTwo = statement.executeQuery("SELECT * FROM person WHERE id = 1");
                while (resultSetTwo.next()) {
                    final String balance = resultSetTwo.getString("balance");
                    System.out.println("[two] Balance: " + balance);
                }

                connection.commit();
            } catch (SQLException e) {
                System.out.println(e.getMessage());
            }
        }
    }

}
```

–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–º–µ—Ä–∞:

```log
[one] Balance: 1000
[two] Balance: 100000
[one] Balance: 100000
```

–î–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –≤–æ—Å–ø–æ–ª—å–∑—É–µ–º—Å—è –∏–∑–≤–µ—Å—Ç–Ω—ã–º –Ω–∞–º —É—Ä–æ–≤–Ω–µ–º –∏–∑–æ–ª—è—Ü–∏–∏ [Repeatable read](Repeatable%20read.md).

–¢–æ–≥–¥–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–∏–º–µ—Ä–∞ –ø–µ—Ä–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–≤–∞–∂–¥—ã –ø–æ–ª—É—á–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ —Ä–∞–≤–Ω—ã–º 1000, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –≤ –ë–î –±—É–¥–µ—Ç —É–∂–µ 100_000.

–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–º–µ—Ä–∞ —Å¬†`REPEATABLE_READ`:
```log
[one] Balance: 1000
[two] Balance: 100000
[one] Balance: 1000
```
## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- [–ü—Ä–∏–º–µ—Ä –Ω–∞ Java](https://github.com/Example-uPagge/transactional/blob/master/jdbc-transaction/src/main/java/dev/struchkov/example/transaction/problems/NonRepeatableRead.java)