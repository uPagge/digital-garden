---
aliases: 
tags:
  - –∑—Ä–µ–ª–æ—Å—Ç—å/üå±
date:
  - - 2024-04-07
zero-link:
  - "[[00 Nginx]]"
parents:
  - "[[–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ]]"
linked:
  - "[[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –≤ Nginx]]"
link: https://struchkov.dev/blog/ru/nginx-optimization/#%D0%BA%D1%8D%D1%88%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BD%D0%B0-%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5-%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0
---
–ï—Å–ª–∏ –∫–∞–∫–∏–µ-—Ç–æ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —á–∞—Å—Ç–æ –º–µ–Ω—è—é—Ç—Å—è, —Ç–æ –º–æ–∂–Ω–æ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞. –¢–æ–≥–¥–∞ Nginx –æ–¥–∏–Ω —Ä–∞–∑ –ø–æ–ª—É—á–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –¥–∞–ª—å—à–µ –±—É–¥–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å –∏—Ö –¥—Ä—É–≥–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º.

–ü–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏, –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –≤ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∞:
```shell
sudo mkdir -p /var/nginx/cache
```

–ß—Ç–æ–±—ã –≤–∫–ª—é—á–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –Ω—É–∂–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–∏–≤ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏¬†`nginx.conf`.

```nginx
http {
    proxy_cache_path /var/nginx/cache levels=1:2 keys_zone=nginxcash:60m max_size=256m inactive=24h;
    proxy_cache_key "$scheme$request_method$host$request_uri";
    proxy_cache_methods GET HEAD;
    proxy_cache_min_uses 2;
}
```

`proxy_cache_path`¬†—É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç—å –≤ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ. –¢–∞–∫–∂–µ —ç—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–¥–∞—Ç—å

–ù–µ –∫—ç—à–∏—Ä—É–π—Ç–µ HTTP-–æ—Ç–≤–µ—Ç—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ¬†`proxy_cache_min_uses 2`, —á—Ç–æ–±—ã –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫ –∫–æ—Ç–æ—Ä—ã–º –æ–±—Ä–∞—â–∞–ª–∏—Å—å –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã —É–º–µ–Ω—å—à–∏—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ–∫—Å–∏-–∫—ç—à–∞ –Ω–∞ –∑–∞–ø–∏—Å—å –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∫—ç—à–∞ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º, –∫ –∫–æ—Ç–æ—Ä–æ–º—É —Ä–µ–¥–∫–æ –æ–±—Ä–∞—â–∞—é—Ç—Å—è.

–ö–ª—é—á –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è Nginx –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å–∞–π—Ç–∞–º–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–æ–¥–¥–æ–º–µ–Ω–∞–º–∏. –í—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–ª—é—á –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –∑–∞–¥–∞–≤ proxy_cache_key. –í —Å–≤–æ–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —è –∏—Å–ø–æ–ª—å–∑—É—é –≤–æ—Ç —Ç–∞–∫–æ–π –∫–ª—é—á: `proxy_cache_key $scheme$host$uri$is_args$args;`

## –ü–µ—Ä–µ–Ω–æ—Å–∏–º –∫—ç—à Nginx –≤ RAM
–ú–æ–∂–Ω–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É—Å–∫–æ—Ä–∏—Ç—å –∫—ç—à, –µ—Å–ª–∏ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –Ω–µ –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –∞ –≤ RAM.

–î–ª—è —ç—Ç–æ–≥–æ —Ç–∞–∫–∂–µ —Å–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –∫—ç—à–∞, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –∂–µ, –Ω–æ –µ–µ –Ω—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –æ—Ç –ø–∞–ø–æ–∫. –î–∞–ª–µ–µ –º–æ–Ω—Ç–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –≤ RAM —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã¬†[tmpfs](https://wiki.archlinux.org/index.php/Tmpfs), –≤—ã–¥–µ–ª—è—è 256 –º–µ–≥–∞–±–∞–π—Ç –ø–æ–¥ –∫—ç—à:

```shell
sudo mount -t tmpfs -o size=256M tmpfs /var/nginx/cache
```

–ï—Å–ª–∏ –≤–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –æ—Ç–∫–ª—é—á–∏—Ç—å RAM-–∫–µ—à, –ø—Ä–æ—Å—Ç–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:

```shell
sudo umount /var/nginx/cache
```

–ß—Ç–æ–±—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –∫–µ—à–∞ –≤ RAM –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞, –Ω–∞–º –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª¬†`/etc/fstab`. –î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–µ–≥–æ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É:

```txt
tmpfs /var/nginx/cache tmpfs defaults,size=256M 0 0
```