---
aliases:
  - phantom reads
tags:
  - –∑—Ä–µ–ª–æ—Å—Ç—å/üå±
date:
  - - 2024-06-19
zero-link:
  - "[[00 –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö]]"
parents:
  - "[[–ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π]]"
linked: 
link: https://struchkov.dev/blog/ru/transactional-isolation-levels/#%D1%84%D0%B0%D0%BD%D1%82%D0%BE%D0%BC%D0%BD%D0%BE%D0%B5-%D1%87%D1%82%D0%B5%D0%BD%D0%B8%D0%B5
---
**–§–∞–Ω—Ç–æ–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ (phantom reads).** –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–≥–æ—Å—è –∑–∞–ø—Ä–æ—Å–∞ –ø–æ—è–≤–ª—è—é—Ç—Å—è –∏ –∏—Å—á–µ–∑–∞—é—Ç —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è. ^ebb2ec

–≠—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ –∏–∑–æ–ª—è—Ü–∏–∏¬†[Repeatable read](Repeatable%20read.md), [Read committed](Read%20committed.md) –∏ [Read uncommitted](Read%20uncommitted.md).

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –ø—Ä–∏–º–µ—Ä. –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç 2. –î–∞–ª–µ–µ —Å—Ç–∞—Ä—Ç—É–µ–º –≤—Ç–æ—Ä—É—é —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é, –∞ –ø–æ—Ç–æ–∫ —Å –ø–µ—Ä–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π –∑–∞—Å—ã–ø–∞–µ—Ç. –í—Ç–æ—Ä–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∫–æ–º–º–∏—Ç–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–µ—Ä–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è. –°–Ω–æ–≤–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫, –ø–æ–ª—É—á–∞–µ–º –Ω–∞ —ç—Ç–æ—Ç —Ä–∞–∑ –æ—Ç–≤–µ—Ç 3.

```java
public class PhantomRead {

    private static final int ISOLATION_LEVEL = Connection.TRANSACTION_READ_COMMITTED;

    public static void main(String[] args) {
        try(
                final Connection connection = Repository.getConnection();
                final Statement statement = connection.createStatement()
        ) {
            connection.setAutoCommit(false);
            connection.setTransactionIsolation(ISOLATION_LEVEL);

            final ResultSet resultSet = statement.executeQuery("SELECT count(*) FROM person");
            while (resultSet.next()) {
                final int count = resultSet.getInt(1);
                System.out.println("Count: " + count);
            }

            new OtherTransaction().start();
            Thread.sleep(2000);

            final ResultSet resultSetTwo = statement.executeQuery("SELECT count(*) FROM person");
            while (resultSetTwo.next()) {
                final int count = resultSetTwo.getInt(1);
                System.out.println("Count: " + count);
            }

        } catch (SQLException | InterruptedException e) {
            throw new RuntimeException(e);
        }
    }

    static class OtherTransaction extends Thread {
        @Override
        public void run() {
            try (
                    final Connection connection = Repository.getConnection();
                    final Statement statement = connection.createStatement()
            ) {
                connection.setAutoCommit(false);
                connection.setTransactionIsolation(ISOLATION_LEVEL);

                statement.executeUpdate("INSERT INTO person(id, balance) values (3, 1000)");
                connection.commit();
            } catch (SQLException e) {
                System.out.println(e.getMessage());
            }
        }
    }

}
```

–ß—Ç–æ–±—ã —É—Å—Ç—Ä–∞–Ω–∏—Ç—å —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–∞–º—ã–π –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å¬†[Serializable](Serializable.md). –û–¥–Ω–∞–∫–æ, –¥–ª—è PostgreSQL –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏¬†`REPEATABLE_READ`.

–ù–æ –º—ã –≤—Å—ë —Ä–∞–≤–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏–º¬†`SERIALIZABLE`. –¢–µ–ø–µ—Ä—å –≤ –ø–µ—Ä–≤–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –Ω–∞–º –¥–≤–∞–∂–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç 2, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ –ø–æ—è–≤–∏–ª–∏—Å—å –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
- [–ü—Ä–∏–º–µ—Ä –Ω–∞ Java](https://github.com/Example-uPagge/transactional/blob/master/jdbc-transaction/src/main/java/dev/struchkov/example/transaction/problems/PhantomRead.java)